<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CanlÄ± Sohbet OdasÄ±</title>
    <style>
        :root {
            --primary: #5f27cd;
            --primary-dark: #4a1eaf;
            --bg-gradient: linear-gradient(135deg, #667eea, #764ba2);
        }
        /* 5 tema */
        body.theme-pink { --primary: #e91e63; --primary-dark: #c2185b; --bg-gradient: linear-gradient(135deg, #ff9a9e, #fad0c4); }
        body.theme-green { --primary: #00c853; --primary-dark: #00b248; --bg-gradient: linear-gradient(135deg, #a8e6cf, #dcedc1); }
        body.theme-blue { --primary: #1e88e5; --primary-dark: #1565c0; --bg-gradient: linear-gradient(135deg, #84fab0, #8fd3f4); }
        body.theme-orange { --primary: #ff9800; --primary-dark: #f57c00; --bg-gradient: linear-gradient(135deg, #ffe259, #ffa751); }
        body.theme-dark { --primary: #212121; --primary-dark: #000000; --bg-gradient: linear-gradient(135deg, #232526, #414345); }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg-gradient);
            margin: 0; padding: 20px; min-height: 100vh;
            display: flex; justify-content: center;
        }
        .container {
            width: 100%; max-width: 420px; background: white; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); overflow: hidden;
        }
        .header {
            background: var(--primary); color: white; padding: 15px; text-align: center;
            font-size: 22px; position: relative;
        }
        .theme-selector {
            position: absolute; right: 10px; top: 10px;
        }
        .theme-selector select {
            background: rgba(255,255,255,0.3); color: white; border: none; border-radius: 8px; padding: 4px 8px;
        }
        #messages {
            height: 65vh; overflow-y: auto; padding: 15px; background: #f8f9fa;
        }
        .message {
            margin: 10px 0; padding: 10px 14px;
            border-radius: 20px; max-width: 80%; word-wrap: break-word;
            position: relative; animation: fadeIn 0.4s;
        }
        .you { background: var(--primary); color: white; margin-left: auto; border-bottom-right-radius: 4px; }
        .other { background: #e0e0e0; color: #333; margin-right: auto; border-bottom-left-radius: 4px; }
        .message small { opacity: 0.7; font-size: 11px; display: block; margin-top: 4px; }
        .input-area {
            display: flex; padding: 12px; background: #fff; border-top: 1px solid #eee; gap: 8px;
        }
        #msg { flex: 1; padding: 12px 16px; border: 1px solid #ddd; border-radius: 30px; outline: none; }
        button { padding: 0 18px; background: var(--primary); color: white; border: none; border-radius: 30px; cursor: pointer; }
        button:hover { background: var(--primary-dark); }
        .emoji-btn { font-size: 24px; cursor: pointer; background: none; border: none; }
        .emoji-picker { display: none; background: white; border: 1px solid #ddd; border-radius: 12px; padding: 10px; max-width: 300px; flex-wrap: wrap; gap: 6px; position: absolute; bottom: 70px; left: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 10; }
        .emoji-picker.show { display: flex; }
        .emoji-picker span { font-size: 24px; cursor: pointer; }
        .emoji-picker span:hover { transform: scale(1.3); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }
        .status { font-size: 13px; color: #4caf50; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            CanlÄ± Sohbet OdasÄ±
            <div class="theme-selector">
                <select onchange="document.body.className='theme-'+this.value">
                    <option value="purple">Mor</option>
                    <option value="pink">Pembe</option>
                    <option value="green">YeÅŸil</option>
                    <option value="blue">Mavi</option>
                    <option value="orange">Turuncu</option>
                    <option value="dark">Koyu</option>
                </select>
            </div>
        </div>
        <div id="messages"></div>
        <div class="input-area">
            <input type="text" id="name" placeholder="AdÄ±n" value="">
            <button class="emoji-btn" onclick="toggleEmoji()">ðŸ˜Š</button>
            <input type="text" id="msg" placeholder="Mesaj yaz...">
            <button onclick="send()">GÃ¶nder</button>
        </div>
        <div class="emoji-picker" id="emojiPicker"></div>
        <audio id="notifySound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-remove-2578.mp3" preload="auto"></audio>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        const SUPABASE_URL = 'https://rtaqxsecuvsncnoovare.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0YXF4c2VjdXZzbmNub292YXJlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2ODcyODcsImV4cCI6MjA4MDI2MzI4N30.18BaKDnEyj97fS5Xl5ZeZsHSwQh6AexkEmMR5QgwUgw'
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        const messagesDiv = document.getElementById('messages')
        const msgInput = document.getElementById('msg')
        const nameInput = document.getElementById('name')
        const emojiPicker = document.getElementById('emojiPicker')
        const sound = document.getElementById('notifySound')

        // AdÄ± hatÄ±rla
        nameInput.value = localStorage.getItem('chatName') || ''

        // Emoji listesi (en Ã§ok kullanÄ±lan 60 tane)
        const emojis = "ðŸ˜€ ðŸ˜ƒ ðŸ˜„ ðŸ˜ ðŸ˜† ðŸ˜… ðŸ˜‚ ðŸ¤£ ðŸ˜Š ðŸ˜‡ ðŸ™‚ ðŸ™ƒ ðŸ˜‰ ðŸ˜Œ ðŸ˜ ðŸ¥° ðŸ˜˜ ðŸ˜— ðŸ˜™ ðŸ˜š ðŸ˜‹ ðŸ˜› ðŸ˜ ðŸ˜œ ðŸ¤ª ðŸ˜Ž ðŸ¤“ ðŸ§ ðŸ¤¨ ðŸ¤© ðŸ¥³ ðŸ˜ ðŸ˜’ ðŸ˜ž ðŸ˜” ðŸ˜Ÿ ðŸ˜• ðŸ™ ðŸ˜£ ðŸ˜– ðŸ˜« ðŸ˜¤ ðŸ˜  ðŸ˜¡ ðŸ¤¬ ðŸ˜­ ðŸ˜¢ ðŸ˜© ðŸ˜° ðŸ˜¨ ðŸ˜± ðŸ˜³ ðŸ˜µ ðŸ˜² ðŸ¤¯ ðŸ¤” ðŸ¤­ ðŸ¤« ðŸ¤¥ ðŸ˜¶ ðŸ˜ ðŸ˜‘ ðŸ˜¬ ðŸ™„ ðŸ˜¯ ðŸ˜¦ ðŸ˜§ ðŸ˜® ðŸ˜´ ðŸ¤¤ ðŸ˜ª ðŸ˜µâ€ðŸ’« ðŸ¤¢ ðŸ¤® ðŸ¤§ ðŸ¤’ ðŸ¤• ðŸ¥´ ðŸ¤‘ ðŸ¤  ðŸ˜¸ ðŸ˜¹ ðŸ˜º ðŸ˜» ðŸ˜¼ ðŸ˜½ ðŸ™€ ðŸ˜¿ ðŸ˜¾"
        emojis.split(' ').forEach(e => {
            const span = document.createElement('span')
            span.textContent = e
            span.onclick = () => { msgInput.value += e; msgInput.focus() }
            emojiPicker.appendChild(span)
        })

        function toggleEmoji() {
            emojiPicker.classList.toggle('show')
        }

        // Realtime + eski mesajlarÄ± yÃ¼kle
        supabase.channel('messages')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
                addMessage(payload.new.username, payload.new.message, payload.new.created_at, true)
                if (payload.new.username !== (nameInput.value || 'Misafir')) sound.play()
            })
            .subscribe()

        async function loadMessages() {
            const { data } = await supabase.from('messages').select().order('created_at', { ascending: true })
            data.forEach(m => addMessage(m.username, m.message, m.created_at, false))
        }

        function addMessage(username, text, time, playSound = false) {
            const timeStr = new Date(time).toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'})
            const isYou = username === (nameInput.value || 'Misafir')
            const div = document.createElement('div')
            div.className = `message ${isYou ? 'you' : 'other'}`
            div.innerHTML = `<strong>${username}</strong><br>${text.replace(/\n/g, '<br>')}<small>${timeStr}</small>`
            messagesDiv.appendChild(div)
            messagesDiv.scrollTop = messagesDiv.scrollHeight
        }

        window.send = async () => {
            let text = msgInput.value.trim()
            if (!text) return
            let username = nameInput.value.trim() || 'Misafir'
            localStorage.setItem('chatName', username)

            await supabase.from('messages').insert({ username, message: text })
            msgInput.value = ''
            emojiPicker.classList.remove('show')
        }

        msgInput.addEventListener('keypress', e => { if (e.key === 'Enter') send() })
        loadMessages()
    </script>
</body>
</html>
